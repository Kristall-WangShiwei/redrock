#!/usr/bin/env python

"""
Redrock for DESI
"""
from __future__ import absolute_import, division, print_function

import sys
import numpy as np

import redrock
from redrock.external import desi

import optparse
parser = optparse.OptionParser(usage = "%prog [options] brickfile1 brickfile2...")
parser.add_option("-t", "--templates", type="string",  help="template directory")
parser.add_option("-o", "--output", type="string",  help="output file")
parser.add_option("--debug", help="debug with ipython", action="store_true")

opts, brickfiles = parser.parse_args()

if opts.output is None:
    print('ERROR: --output required')
    sys.exit(1)

if len(brickfiles) == 0:
    print('ERROR: must provide input brick files')
    sys.exit(1)

targets = desi.read_bricks(brickfiles)
templates = redrock.io.read_templates(opts.templates)
results = redrock.zfind(targets, templates[0:1])
redrock.io.write_zscan(opts.output, results)

if opts.debug:
    import IPython
    IPython.embed()    


